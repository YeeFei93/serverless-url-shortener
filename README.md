# Serverless URL Shortener on AWS

A serverless URL shortener built using AWS Lambda, API Gateway, DynamoDB, S3, CloudFront, and Terraform. Provides URL shortening functionality with a web interface.

---

## Features

### Core Functionality
- Static web UI hosted on S3 + CloudFront (`https://ui.sctp-sandbox.com`)
- Short links powered by API Gateway + Lambda (`https://short.sctp-sandbox.com`)
- Auto-generated 8-character short codes using UUID
- Serverless and scalable architecture
- Infrastructure as Code provisioning with Terraform
- CORS support with dedicated OPTIONS Lambda
- Custom domains with SSL certificates via AWS Certificate Manager
- DNS routing via Amazon Route 53
- HTTPS enforcement with TLS 1.2

### Security & Monitoring
- AWS WAF protection with rate limiting and managed rules
- CloudWatch monitoring with dashboards and alarms
- X-Ray distributed tracing enabled on all Lambda functions
- IAM least privilege access policies
- Centralized logging with retention policies
- Security groups for network-level controls

---

## Deployment Status

**DEPLOYED**

- Infrastructure provisioned via Terraform
- Lambda functions deployed and tested  
- Custom domains configured with SSL certificates
- Frontend UI accessible at `https://ui.sctp-sandbox.com`
- API endpoints active at `https://short.sctp-sandbox.com`

> **Note**: This project runs on a student AWS account where resources are cleaned up daily. 
> 
> **ğŸš€ Auto-Deployment Available**: GitHub Actions workflow automatically redeploys resources daily at 8:00 AM UTC. See [GITHUB_ACTIONS_SETUP.md](GITHUB_ACTIONS_SETUP.md) for setup instructions.
>
> **Manual deployment**: Run `terraform apply` to redeploy if needed.

---

## Architecture Diagram

```text
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚    Client (Browser)    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  CloudFront (ui.sctp-sandbox.com)  â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚      S3 Bucket     â”‚
                     â”‚   Static Website   â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚     API Gateway (short.sctp...)  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                          â”‚             â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ shorten.pyâ”‚    â”‚ redirect.py  â”‚
                 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼               â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚      DynamoDB: UrlTable      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Live Demo

- Frontend UI: [https://ui.sctp-sandbox.com](https://ui.sctp-sandbox.com)
- Backend API: [https://short.sctp-sandbox.com](https://short.sctp-sandbox.com)

Paste a long URL on the UI and click **Shorten** â€” youâ€™ll receive a short redirectable link!

---

## Project Structure

```
serverless-url-shortener/
â”œâ”€â”€ lambda/
â”‚   â”œâ”€â”€ shorten.py        # Handles POST /shorten
â”‚   â”œâ”€â”€ redirect.py       # Handles GET /{short_id}
â”‚   â”œâ”€â”€ options.py        # Handles OPTIONS /shorten for CORS
â”‚   â””â”€â”€ (*.zip files generated by build.sh)
â”œâ”€â”€ terraform/            # Infrastructure as Code (organized by service)
â”‚   â”œâ”€â”€ main.tf           # Entry point with documentation
â”‚   â”œâ”€â”€ providers.tf      # AWS provider and data sources
â”‚   â”œâ”€â”€ variables.tf      # Input variables
â”‚   â”œâ”€â”€ outputs.tf        # Output values
â”‚   â”œâ”€â”€ database.tf       # DynamoDB table
â”‚   â”œâ”€â”€ iam.tf            # IAM roles and policies
â”‚   â”œâ”€â”€ lambda.tf         # Lambda functions
â”‚   â”œâ”€â”€ api-gateway.tf    # API Gateway, routes, and integrations
â”‚   â”œâ”€â”€ frontend.tf       # S3 bucket and CloudFront
â”‚   â”œâ”€â”€ dns.tf            # Route 53 records and SSL certificates
â”‚   â”œâ”€â”€ monitoring.tf     # CloudWatch dashboards, alarms, and logging
â”‚   â””â”€â”€ security.tf       # WAF, security groups, and enhanced IAM
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ index.html        # HTML + JS UI (calls short.sctp-sandbox.com)
â”œâ”€â”€ build.sh              # Script to build Lambda deployment packages
â””â”€â”€ README.md
```

**File Responsibilities:**
- **`providers.tf`** - Provider configuration and shared data sources
- **`database.tf`** - All DynamoDB-related resources
- **`iam.tf`** - IAM roles, policies, and permissions
- **`lambda.tf`** - Lambda functions with consistent naming and tagging
- **`api-gateway.tf`** - API Gateway, integrations, routes, and permissions
- **`frontend.tf`** - S3 bucket configuration and CloudFront distribution
- **`dns.tf`** - SSL certificates, DNS validation, and Route 53 records
- **`monitoring.tf`** - CloudWatch dashboards, alarms, and logging
- **`security.tf`** - WAF, security groups, and enhanced IAM

---

## Automated Deployment

### GitHub Actions (Recommended)

Set up automated daily deployment using GitHub Actions:

1. **Quick Setup**: Run the setup script
   ```bash
   chmod +x setup-aws-for-github-actions.sh
   ./setup-aws-for-github-actions.sh
   ```

2. **Manual Setup**: Follow the detailed guide in [GITHUB_ACTIONS_SETUP.md](GITHUB_ACTIONS_SETUP.md)

**Features:**
- Daily automatic deployment at 8:00 AM UTC
- Manual trigger with optional resource cleanup
- Health checks and deployment status notifications  
- Support for both OIDC and AWS access key authentication
- Terraform remote state management

### Manual Deployment

## Deployment Guide

### Prerequisites
- AWS CLI configured with appropriate permissions
- Terraform installed (v1.0+)
- Access to a Route 53 hosted zone for `sctp-sandbox.com`

### 1. Clone the Repository

```bash
git clone https://github.com/YeeFei93/serverless-url-shortener.git
cd serverless-url-shortener
```

### 2. Build Lambda Deployment Packages

```bash
./build.sh
```

This script creates the necessary ZIP files for Lambda deployment:
- `lambda/shorten.zip` - URL shortening functionality
- `lambda/redirect.zip` - URL redirection functionality  
- `lambda/options.zip` - CORS preflight handling

### 3. Deploy Infrastructure

```bash
cd terraform
terraform init
terraform apply
```

**What happens during deployment:**
- **`providers.tf`** configures AWS provider and retrieves Route 53/IAM data
- **`database.tf`** creates DynamoDB table with proper configuration
- **`iam.tf`** attaches necessary policies to Lambda execution role
- **`lambda.tf`** deploys all three Lambda functions (shorten, redirect, options)
- **`api-gateway.tf`** sets up HTTP API with routes and integrations
- **`dns.tf`** provisions SSL certificates and configures DNS records
- **`frontend.tf`** creates S3 bucket, uploads files, and sets up CloudFront
- **`monitoring.tf`** deploys CloudWatch dashboards, alarms, and log groups
- **`security.tf`** configures WAF protection and enhanced security policies

The organized file structure makes it easy to understand and troubleshoot each deployment phase.

**Note:** The infrastructure is already deployed. SSL certificates are automatically provisioned and validated via Route 53.

### 4. Frontend Deployment (Automated)

The frontend `index.html` is automatically uploaded to S3 via Terraform and served through CloudFront.

---

## API Endpoints

### POST `/shorten`

**Request:**
```bash
curl -X POST https://short.sctp-sandbox.com/shorten \
-H "Content-Type: application/json" \
-d '{"url": "https://www.example.com"}'
```

**Response:**
```json
{
  "short_url": "https://short.sctp-sandbox.com/abc12345"
}
```

---

### GET `/{short_id}`

Redirects to the original URL.

```bash
curl -I https://short.sctp-sandbox.com/abc12345
```

**Response:**
```
HTTP/2 302
Location: https://www.example.com
```

---

## Deployment Highlights

- Custom domain names:
  - API: `https://short.sctp-sandbox.com`  
  - Frontend: `https://ui.sctp-sandbox.com`
- SSL certificates issued and validated via AWS Certificate Manager
- DNS routing configured using Amazon Route 53
- Infrastructure as Code provisioned via Terraform
- Single `terraform apply` deploys entire stack
- Separate certificates for each domain
- Modular Terraform structure organized by service
- Consistent naming, tagging, and dependency management

---

## Built With

- [AWS Lambda](https://aws.amazon.com/lambda/)
- [Amazon API Gateway](https://aws.amazon.com/api-gateway/)
- [Amazon DynamoDB](https://aws.amazon.com/dynamodb/)
- [Amazon S3 + CloudFront](https://aws.amazon.com/cloudfront/)
- [Terraform](https://www.terraform.io/)
- [Python 3.9](https://www.python.org/)

---

## Implementation Status & Future Improvements

### Completed Features
- [x] Basic URL shortening functionality
- [x] Custom domains for both frontend and API
- [x] SSL/TLS security with HTTPS enforcement
- [x] CORS support for cross-domain API calls
- [x] Complete Terraform infrastructure automation
- [x] Static web UI with clean interface
- [x] Modular Terraform structure organized by service
- [x] CloudWatch monitoring with dashboards and alarms
- [x] X-Ray distributed tracing enabled on all Lambda functions
- [x] AWS WAF protection with rate limiting and managed rules
- [x] IAM least privilege access policies
- [x] Centralized logging with retention policies

### Future Enhancements
- [ ] Custom analytics (click count tracking)
- [ ] Link expiration support with TTL
- [ ] Admin dashboard for URL management and analytics
- [ ] Vanity URLs (custom short codes)
- [ ] Short ID collision detection and retry logic
- [ ] Rate limiting to prevent abuse
- [ ] Bulk URL shortening via CSV upload
- [ ] QR code generation for shortened URLs
